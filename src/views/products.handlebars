<h1 class="tipografia">Products</h1>
{{#if productos.length}}
<ul>
    {{#each productos}}
    <div class="prodList">
        <h2>{{title}}</h2>
        <img src="{{this.img}}" alt="{{this.title}}" class="productImage">
        <p>{{this._id}}</p>
        <p class="categorySte">{{description}}</p>
        <p>Price: ${{price}}</p>
        <p>Category: {{category}}</p>
        <button class="pointer hover" onclick="window.open('/products/{{this._id}}', '_blank')">Ver Mas</button><br>

        <!-- Aquí está el formulario -->
        <form action="/cart/{{cartId}}/products/{{this._id}}" method="POST" class="add-to-cart-form">
    <input type="hidden" name="quantity" value="1">
    <button type="submit" class="pointer hover">Add to Cart</button>
</form>
        
        <br><br><br>
    </div>
    {{/each}}
</ul>
{{else}}
<p>No products found on this page.</p>
{{/if}}



<br>
<br>

<hr>
<div class="pagination-container">
    {{#if hasPrevPage}}
    <a href="/products?page={{prevPage}}" class="prev-page">Previous</a>
    {{/if}}
    {{#if hasNextPage}}
    <a href="/products?page={{nextPage}}" class="next-page">Next</a>
    {{/if}}
    <br>
    <div>
        <p class="textPag">Page {{currentPage}} of {{totalPages}}</p>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const selectElements = document.querySelectorAll('select[name="cartId"]');

        selectElements.forEach(select => {
            fetch('/api/carts')
                .then(response => response.json())
                .then(carts => {
                    console.log('Carts received:', carts); // Verifica que los datos estén llegando
                    if (carts.length > 0) {
                        select.innerHTML = carts.map(cart => `<option value="${cart.id}">Cart ID: ${cart.id}</option>`).join('');
                    } else {
                        select.innerHTML = '<option value="">No carts available</option>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching carts', error);
                    select.innerHTML = '<option value="">Failed to load carts</option>';
                });
        });
    });

</script>